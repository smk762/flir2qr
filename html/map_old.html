<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
        <html xmlns="http://www.w3.org/1999/xhtml"
          <head>
            <title>ZIP_FILENAME_VAR</title><link rel="stylesheet" href="/flir2qr/css/style.css" />
            <meta http-equiv='imagetoolbar' content='no'/>
            <style type="text/css"> v\:* {behavior:url(#default#VML);}
                html, body { overflow: hidden; padding: 0; height: 100%; width: 100%; font-family: 'Lucida Grande',Geneva,Arial,Verdana,sans-serif; }
                body { margin: 10px; background: #fff; }
                h1 { margin: 0; padding: 6px; border:0; font-size: 20pt; }
            #header { height: 43px; padding: 0; background-color: #eee; border: 1px solid #888; }
            #subheader { height: 12px; text-align: right; font-size: 10px; color: #555;}
            #map { height: 95%; border: 1px solid #888; }
            .olImageLoadError { display: none; }
            .olControlLayerSwitcher .layersDiv { border-radius: 10px 0 0 10px; }
              a {
                color: blue; 
              }
        </style>
            <script src='http://maps.google.com/maps/api/js?sensor=false&v=3.7'></script>
            


            <script src="/flir2qr/js/ol.js"></script>
            <script>
              var map;
              MAP_BOUNDS_VAR
              var mapMinZoom = 10;
              var mapMaxZoom = 19;
              var emptyTileURL = "http://www.maptiler.org/img/none.png";
              OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;


var style = OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['default']);
    style.fillOpacity = 0.1;
    style.graphicOpacity = 1;
    style.strokeWidth = 1; 
    style.strokeColor = "#D000FF";
    style.strokeOpacity = 1;

var style_hover = OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['hover']);
    style_hover.fillOpacity = 0.3;
    style_hover.graphicOpacity = 1;
    style_hover.strokeWidth = 2; 
    style_hover.strokeColor = "#00A5FF";
    style_hover.strokeOpacity = 1;

var style_hover = OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['select']);
    style_hover.fillOpacity = 0.5;
    style_hover.graphicOpacity = 1;
    style_hover.strokeWidth = 2; 
    style_hover.strokeColor = "#00FF65";
    style_hover.strokeOpacity = 1;

    var footprint_styles = new OpenLayers.StyleMap({
        'default': style,
            'select': style_hover
    });

              function init(){
                  var options = {
                      div: "map",
                      controls: [],
                      projection: "EPSG:3857",
                      displayProjection: new OpenLayers.Projection("EPSG:4326"),
                      numZoomLevels: 20
                  };
                  map = new OpenLayers.Map(options);

                  // Create Bing layers
                  var broad = new OpenLayers.Layer.Bing({
                      name: "Bing Roads",
                      key: "Ag4sqB8_1kZH0Uqc4M1kZeN1hoWHTvmv-cv7PR_YO04PKMvevlYzKyLEcEuy_j_J",
                      type: "Road",
                      sphericalMercator: true
                  });
                  var baer = new OpenLayers.Layer.Bing({
                      name: "Bing Aerial",
                      key: "Ag4sqB8_1kZH0Uqc4M1kZeN1hoWHTvmv-cv7PR_YO04PKMvevlYzKyLEcEuy_j_J",
                      type: "Aerial",
                      sphericalMercator: true
                  });
                  var bhyb = new OpenLayers.Layer.Bing({
                      name: "Bing Hybrid",
                      key: "Ag4sqB8_1kZH0Uqc4M1kZeN1hoWHTvmv-cv7PR_YO04PKMvevlYzKyLEcEuy_j_J",
                      type: "AerialWithLabels",
                      sphericalMercator: true
                  });

                  // create TMS Overlay layer
                   var tmsoverlay = new OpenLayers.Layer.TMS("COG", "",
                  {
                      serviceVersion: '.',
                      layername: '.',
                      alpha: true,
                      type: 'png',
                      isBaseLayer: false,
                      getURL: getURL
                  });
                  if (OpenLayers.Util.alphaHack() == false) {
                      tmsoverlay.setOpacity(0.7);
                  }

                  map.addLayers([bhyb, broad, baer, tmsoverlay]); 
                              



    var foot_kml =  new OpenLayers.Layer.Vector("Tile Footprints", {
        projection: map.displayProjection,
        styleMap : footprint_styles,
        strategies: [new OpenLayers.Strategy.Fixed()],
        protocol: new OpenLayers.Protocol.HTTP({
            url: "FOOTPRINT_KML_VAR",
            format: new OpenLayers.Format.KML({
                extractStyles: false, 
                extractAttributes: true
            })
        })
  });


    var hs_kml =  new OpenLayers.Layer.Vector("Hotspots", {
        projection: map.displayProjection,
        styleMap : footprint_styles,
        strategies: [new OpenLayers.Strategy.Fixed()],
        protocol: new OpenLayers.Protocol.HTTP({
            url: "HOTSPOT_KML_VAR",
            format: new OpenLayers.Format.KML({
                extractStyles: false, 
                extractAttributes: true
            })
        })
  });
    
        //Add a selector control to the kmllayer with popup functions
        var controls = {
          selector: new OpenLayers.Control.SelectFeature(foot_kml, { onSelect: createPopup, onUnselect: destroyPopup, clickout: true}),
          highlight: new OpenLayers.Control.SelectFeature(foot_kml, { hover: true, highlightOnly: true, renderIntent: "temporary" }),
        };

        L.control.ruler(options).addTo(map);        


        function bubble_content (feature) {
          tile_name = feature.attributes.name.split(' ')[1];
          content='<div class="markerContent"><a href="MISSION_HTTP_VAR/pdf/'+tile_name+'_merged.pdf"><img src="MISSION_HTTP_VAR/kml/'+tile_name+'_qr.png" /><br />IR tile '+tile_name+' PDF</a></div>'
          return content;
        }
        

        function createPopup(feature) {
          feature.popup = new OpenLayers.Popup("pop",
              feature.geometry.getBounds().getCenterLonLat(),
              new OpenLayers.Size(200,150),
              bubble_content(feature),
              null,
              false,
              function() { controls['selector'].unselectAll(); }
          );
          feature.popup.closeOnMove = true;
          map.addPopup(feature.popup);
        }

        function destroyPopup(feature) {
          feature.popup.destroy();
          feature.popup = null;
        }

        map.addControl(controls['highlight']);
        map.addControl(controls['selector']);
        controls['highlight'].activate();
        controls['selector'].activate();

              
                  map.addLayer(hs_kml);  
                  map.addLayer(foot_kml);

                  var switcherControl = new OpenLayers.Control.LayerSwitcher();
                  map.addControl(switcherControl);
                  switcherControl.maximizeControl();

                  map.zoomToExtent(mapBounds.transform(map.displayProjection, map.projection));
          
                  map.addControls([new OpenLayers.Control.PanZoomBar(),
                                   new OpenLayers.Control.Navigation(),
                                   new OpenLayers.Control.MousePosition(),
                                   new OpenLayers.Control.ArgParser(),
                                   new OpenLayers.Control.Attribution()]);
              }
        
              function getURL(bounds) {
                  bounds = this.adjustBounds(bounds);
                  var res = this.getServerResolution();
                  var x = Math.round((bounds.left - this.tileOrigin.lon) / (res * this.tileSize.w));
                  var y = Math.round((bounds.bottom - this.tileOrigin.lat) / (res * this.tileSize.h));
                  var z = this.getServerZoom();
                  if (this.map.baseLayer.CLASS_NAME === 'OpenLayers.Layer.Bing') {
                      z+=1;
                  }
                  var path = this.serviceVersion + "/" + this.layername + "/" + z + "/" + x + "/" + y + "." + this.type;
                  var url = this.url;
                  if (OpenLayers.Util.isArray(url)) {
                      url = this.selectUrl(path, url);
                  }
                  if (mapBounds.intersectsBounds(bounds) && (z >= mapMinZoom) && (z <= mapMaxZoom)) {
                      return url + path;
                  } else {
                      return emptyTileURL;
                  }
              }
            
           function getWindowHeight() {
                if (self.innerHeight) return self.innerHeight;
                    if (document.documentElement && document.documentElement.clientHeight)
                        return document.documentElement.clientHeight;
                    if (document.body) return document.body.clientHeight;
                        return 0;
                }

                function getWindowWidth() {
                    if (self.innerWidth) return self.innerWidth;
                    if (document.documentElement && document.documentElement.clientWidth)
                        return document.documentElement.clientWidth;
                    if (document.body) return document.body.clientWidth;
                        return 0;
                }

                function resize() {
                    var map = document.getElementById("map");
                    var header = document.getElementById("header");
                    var subheader = document.getElementById("subheader");
                    map.style.height = (getWindowHeight()-80) + "px";
                    map.style.width = (getWindowWidth()-20) + "px";
                    header.style.width = (getWindowWidth()-20) + "px";
                    subheader.style.width = (getWindowWidth()-20) + "px";
                    if (map.updateSize) { map.updateSize(); };
                }

                onresize=function(){ resize(); };

                </script>
              </head>
              <body onload="init()">
                <div id="header"><h1>ZIP_FILENAME_VAR</h1></div>
                <div id="subheader">Generated by <a href="http://www.klokan.cz/projects/gdal2tiles/">GDAL2Tiles</a>, Copyright &copy; 2008 <a href="http://www.klokan.cz/">Klokan Petr Pridal</a>,  <a href="http://www.gdal.org/">GDAL</a> &amp; <a href="http://www.osgeo.org/">OSGeo</a> <a href="http://code.google.com/soc/">GSoC</a>
                <!-- PLEASE, LET THIS NOTE ABOUT AUTHOR AND PROJECT SOMEWHERE ON YOUR WEBSITE, OR AT LEAST IN THE COMMENT IN HTML. THANK YOU -->
                </div>
                <div id="map"></div>
                <script type="text/javascript" >resize()</script>
              </body>
            </html>
